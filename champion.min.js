(function(a){"use strict";var b=this.champ={},c=(b.debug={on:!1,log:function(){this.on&&console.log&&console.log.apply(console,arguments)}},b.DOMEvents=["blur","focus","focusin","focusout","load","resize","scroll","unload","click","dblclick","mousedown","mouseup","mousemove","mouseover","mouseout","mouseenter","mouseleave","change","select","submit","keydown","keypress","keyup","error"]);this.champ.views={},this.champ.models={},this.champ.presenters={},b.extend=function(a,b,c){c=c||[];for(var d in b){for(var e=0;e<c.length;e++)!(c[e]in b);a[d]=b[d]}return a};var d=b.Class=function i(a,b){return 1===arguments.length?new i(null,a):(i.init=i.init||!0,this.id=a||"class"+Date.now()||(new Date).getTime(),this.properties=b||{},i.init&&this.init(b),void 0)};d.prototype=b.extend(d.prototype,{init:function(){},get:function(a){if("string"!=typeof a){for(var b={},c=0;c<a.length;c++)b[a[c]]=this.get(a[c]);return b}if(!a in this.properties)throw"Property does not exist";return this.properties[a]},set:function(a,c){if("string"==typeof a)return-1===a.indexOf(".")?this.properties[a]=c:b.namespace.call(this.properties,a,c);for(var d in a)a.hasOwnProperty(d)&&this.set(d,a[d])}}),d.extend=function(a){d.init=!1;var c=this,e=new this;d.init=!0;var f=function(){return c.apply(this,arguments)};return f.prototype=b.extend(e,a),f.constructor=d,f.extend=d.extend,f},b.namespace=function j(a,b){if("string"==typeof a)return j.call(this,a.split("."),b);var c=a.splice(0,1);return this[c]=this[c]||{},0===a.length?this[c]=b||this[c]:j.call(this[c],a,b)};var e=b.events=function(){var a={};return{trigger:function(b,c){var d=a[b]||[];for(var e in d)d[e](c,b)},on:function(b,c){a[b]=a[b]||[],a[b].push(c)},off:function(b,c){for(var d=a[b]||[],e=0;e<d.length;e++)""+d[e]==""+c&&d.splice(e,1)}}}();!function(a,b,c){var d=[],e=!1,f=null,g=null,h={},i=function(){f=!!("pushState"in b.history),l(),j()},j=function(){b.addEventListener("load",l,!1),b.addEventListener("click",m,!1),1==f?b.addEventListener("popstate",k,!1):n()},k=function(){q(c.location.pathname)},l=function(){0==e&&(q(c.location.pathname),e=!0)},m=function(a){if(1==s(a)&&!(a.metaKey||a.ctrlKey||a.shiftKey||a.defaultPrevented)){for(var b=a.target;b&&"A"!=b.nodeName;)b=b.parentNode;if(b&&"A"==b.nodeName){var c=b.getAttribute("href");if((b.pathname!=location.pathname||!b.hash&&"#"!=c)&&!b.target&&t(b.href)){var d=b.pathname+b.search+(b.hash||""),e=d+b.hash;d=d.replace("/",""),e!=d&&(a.preventDefault(),o(e))}}}},n=function(){setInterval(function(){var a=b.location.href;g!==a&&(g=a,q(c.location.pathname))})},o=function(a){1==q(a)&&(f?b.history.replaceState(null,b.document.title,r()+a):b.location.hash=a)},p=function(a){var b=new RegExp(":([^/.\\\\]+)","g"),c=""+a,d=b.exec(a);return null!=d&&(c=c.replace(d[0],"([^/.\\\\]+)")),c+="$",{regex:new RegExp(c)}},q=function(a){for(var b=0;b<d.length;b++){var c=d[b],e=c.params.regex.exec(a);if(e)return c.callback({url:a}),!0}return!1},r=function(){var a=b.location.protocol+"//"+b.location.hostname;return b.location.port&&(a+=":"+b.location.port),a},s=function(a){a=a||b.event;var c=null==a.which?a.button:a.which;return c},t=function(a){return 0==a.indexOf(r())};i(),h.addRoute=function(a,b){d.push({params:p(a),callback:b})},a.router=h}(b||{},window,document);var f=b.view=function(c,d){return this instanceof f?(d=d||{},this.name=Array.prototype.splice.call(arguments,0,1),this.container=a(d.container),this.DOM=d.DOM||{},this.registerDom(this.DOM),this.registerDomEvents(),b.extend(this,d,["name","container","DOM"]),this.init.apply(this,arguments),b.namespace("views")[c]=this,void 0):new f(c,d)};b.extend(f.prototype,{init:function(){},addDom:function(a,b){b=this.container.find(b),b.length>0&&(this.DOM[a]=b)},registerDom:function(a){for(var b in a)this.addDom(b,a[b])},registerDomEvents:function(){for(var a in this.DOM){var b=this.DOM[a];b.on(c.join(" "),function(a,b){return function(c){e.trigger("view:"+a.name+":"+b+" "+c.type,c)}}(this,a))}}}),b.view.extend=function(a){return function(c,d){return b.view(c,b.extend(a,d))}};var g=b.model=function(a,c){return this instanceof g?(c=c||{},this.name=Array.prototype.splice.call(arguments,0,1)[0]||"model"+(Date.now?Date.now():(new Date).getTime())/1e3,this.properties=c.properties||{},b.extend(this,c,["name","properties"]),this.init.apply(this,arguments),b.namespace("models")[a]=this,void 0):new g(a,c)};b.extend(g.prototype,{init:function(){},property:function k(a,b,c){if("string"==typeof a){if(!this.properties[a]&&!b)throw"Property doesn't exist";if(!b)return this.properties[a];this.properties[a]=b,c||e.trigger("model:"+this.name+":changed",{property:a,value:b})}else for(var d in a)a.hasOwnProperty(d)&&k.call(this,d,a[d],b)}}),b.model.extend=function l(a){function c(a,c){return b.model(a,c)}return c.extend=l,c.prototype=b.extend(c.prototype,a),c.prototype.constructor=this,c};var h=b.presenter=function(a,c){return this instanceof h?(c=c||{},this.name=Array.prototype.splice.call(arguments,0,1),this.views=c.views||{},this.models=c.models||{},this.events=c.events||{},this.register("models",this.models),this.register("views",this.views),this.registerViewEvents(this.events),b.extend(this,c,["name","views","models","events"]),this.init.apply(this,arguments),b.namespace("presenters")[a]=this,void 0):new h(a,c)};b.extend(h.prototype,{init:function(){},register:function(a,c){var d=this[a]=this[a]||{};if("string"==typeof c)return d[c]=b.namespace(a)[c],void 0;for(var e=0;e<c.length;e++)d[c[e]]=b.namespace(a)[c[e]]},registerViewEvents:function(a){for(var b in a)e.on(b,this[a[b]].bind(this))}}),b.presenter.extend=function(a){return function(c,d){return b.presenter(c,b.extend(a,d))}},function(a){var b={};b.render=function(){console.log("templateengine.get still in development")},a.templates=a.templates||{},a.templates.render=b.render}(b||{}),function(a,b){var c={},d={},e=function(a){var c=b.Deferred(),d=c.promise(),e=b.ajax({async:!0,cache:!0,url:a});return e.success(function(a){c.resolve(a)}),e.error(function(a){c.reject(a)}),d},f=function(a){return d[a]},g=function(a,b){d[a]=b},h=function(a){var c=b.Deferred(),d=c.promise(),h=f(a);return null!=h?c.resolve(h):b.when(e(a)).then(function(b){null!=b&&g(a,b),c.resolve(b)}),d};c.get=function(a){h(a)},a.templates=a.templates||{},a.templates.get=c.get}(b||{},jQuery)}).call(this,jQuery);